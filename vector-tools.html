<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>15 Vector tools | R for Data Science (2e)</title>
<meta name="author" content="Hadley Wickham and Garrett Grolemund">
<meta name="description" content="You are reading the work-in-progress second edition of R for Data Science. This chapter is currently currently a dumping ground for ideas, and we don’t recommend reading it. You can find the...">
<meta name="generator" content="bookdown 0.23 with bs4_book()">
<meta property="og:title" content="15 Vector tools | R for Data Science (2e)">
<meta property="og:type" content="book">
<meta property="og:url" content="https://r4ds.had.co.nz/vector-tools.html">
<meta property="og:image" content="https://r4ds.had.co.nz//cover.png">
<meta property="og:description" content="You are reading the work-in-progress second edition of R for Data Science. This chapter is currently currently a dumping ground for ideas, and we don’t recommend reading it. You can find the...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="15 Vector tools | R for Data Science (2e)">
<meta name="twitter:site" content="@hadley">
<meta name="twitter:description" content="You are reading the work-in-progress second edition of R for Data Science. This chapter is currently currently a dumping ground for ideas, and we don’t recommend reading it. You can find the...">
<meta name="twitter:image" content="https://r4ds.had.co.nz//cover.png">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/header-attrs-2.10/header-attrs.js"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.2.5.1/tabs.js"></script><script src="libs/bs3compat-0.2.5.1/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="libs/htmlwidgets-1.5.3/htmlwidgets.js"></script><link href="libs/leaflet-1.3.1/leaflet.css" rel="stylesheet">
<script src="libs/leaflet-1.3.1/leaflet.js"></script><link href="libs/leafletfix-1.0.0/leafletfix.css" rel="stylesheet">
<script src="libs/proj4-2.6.2/proj4.min.js"></script><script src="libs/Proj4Leaflet-1.0.1/proj4leaflet.js"></script><link href="libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet">
<script src="libs/leaflet-binding-2.0.4.1/leaflet.js"></script><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-115082821-1"></script><script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-115082821-1');
    </script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS -->
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">R for Data Science (2e)</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html">Welcome</a></li>
<li><a class="" href="preface-to-the-second-edition.html">Preface to the second edition</a></li>
<li><a class="" href="introduction.html"><span class="header-section-number">1</span> Introduction</a></li>
<li class="book-part">Whole game</li>
<li><a class="" href="explore-intro.html"><span class="header-section-number">2</span> Introduction</a></li>
<li><a class="" href="data-visualisation.html"><span class="header-section-number">3</span> Data visualisation</a></li>
<li><a class="" href="workflow-basics.html"><span class="header-section-number">4</span> Workflow: basics</a></li>
<li><a class="" href="data-transform.html"><span class="header-section-number">5</span> Data transformation</a></li>
<li><a class="" href="data-tidy.html"><span class="header-section-number">6</span> Data tidying</a></li>
<li><a class="" href="workflow-pipes.html"><span class="header-section-number">7</span> Workflow: pipes</a></li>
<li><a class="" href="data-import.html"><span class="header-section-number">8</span> Data import</a></li>
<li><a class="" href="workflow-scripts.html"><span class="header-section-number">9</span> Workflow: scripts</a></li>
<li><a class="" href="exploratory-data-analysis.html"><span class="header-section-number">10</span> Exploratory Data Analysis</a></li>
<li><a class="" href="workflow-projects.html"><span class="header-section-number">11</span> Workflow: projects</a></li>
<li class="book-part">Transform</li>
<li><a class="" href="data-types-intro.html"><span class="header-section-number">12</span> Introduction</a></li>
<li><a class="" href="tibbles.html"><span class="header-section-number">13</span> Tibbles</a></li>
<li><a class="" href="relational-data.html"><span class="header-section-number">14</span> Relational data</a></li>
<li><a class="active" href="vector-tools.html"><span class="header-section-number">15</span> Vector tools</a></li>
<li><a class="" href="logicals-numbers.html"><span class="header-section-number">16</span> Logicals and numbers</a></li>
<li><a class="" href="missing-values.html"><span class="header-section-number">17</span> Missing values</a></li>
<li><a class="" href="strings.html"><span class="header-section-number">18</span> Strings</a></li>
<li><a class="" href="regular-expressions.html"><span class="header-section-number">19</span> Regular expressions</a></li>
<li><a class="" href="factors.html"><span class="header-section-number">20</span> Factors</a></li>
<li><a class="" href="dates-and-times.html"><span class="header-section-number">21</span> Dates and times</a></li>
<li><a class="" href="column-wise.html"><span class="header-section-number">22</span> Column-wise operations</a></li>
<li class="book-part">Import</li>
<li><a class="" href="import-intro.html"><span class="header-section-number">23</span> Introduction</a></li>
<li><a class="" href="import-rectangular.html"><span class="header-section-number">24</span> Rectangular data</a></li>
<li><a class="" href="import-spreadsheets.html"><span class="header-section-number">25</span> Spreadsheets</a></li>
<li><a class="" href="import-databases.html"><span class="header-section-number">26</span> Databases</a></li>
<li><a class="" href="import-webscrape.html"><span class="header-section-number">27</span> Web scraping</a></li>
<li><a class="" href="import-other.html"><span class="header-section-number">28</span> Other types of data</a></li>
<li class="book-part">Tidy</li>
<li><a class="" href="wrangle-intro.html"><span class="header-section-number">29</span> Introduction</a></li>
<li><a class="" href="list-columns.html"><span class="header-section-number">30</span> List columns</a></li>
<li><a class="" href="rectangle-data.html"><span class="header-section-number">31</span> Data rectangling</a></li>
<li class="book-part">Program</li>
<li><a class="" href="program-intro.html"><span class="header-section-number">32</span> Introduction</a></li>
<li><a class="" href="pipes.html"><span class="header-section-number">33</span> Pipes</a></li>
<li><a class="" href="functions.html"><span class="header-section-number">34</span> Functions</a></li>
<li><a class="" href="vectors.html"><span class="header-section-number">35</span> Vectors</a></li>
<li><a class="" href="iteration.html"><span class="header-section-number">36</span> Iteration</a></li>
<li><a class="" href="programming-with-strings.html"><span class="header-section-number">37</span> Programming with strings</a></li>
<li class="book-part">Communicate</li>
<li><a class="" href="communicate-intro.html"><span class="header-section-number">38</span> Introduction</a></li>
<li><a class="" href="r-markdown.html"><span class="header-section-number">39</span> R Markdown</a></li>
<li><a class="" href="graphics-for-communication.html"><span class="header-section-number">40</span> Graphics for communication</a></li>
<li><a class="" href="r-markdown-formats.html"><span class="header-section-number">41</span> R Markdown formats</a></li>
<li><a class="" href="r-markdown-workflow.html"><span class="header-section-number">42</span> R Markdown workflow</a></li>
</ul>

        <div class="book-extra">
          <p><a id="book-repo" href="https://github.com/hadley/r4ds">View book source <i class="fab fa-github"></i></a></p>
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="vector-tools" class="section level1" number="15">
<h1>
<span class="header-section-number">15</span> Vector tools<a class="anchor" aria-label="anchor" href="#vector-tools"><i class="fas fa-link"></i></a>
</h1>
<div class="rmdnote">
<p>You are reading the work-in-progress second edition of R for Data Science. This chapter is currently currently a dumping ground for ideas, and we don’t recommend reading it. You can find the polished first edition at <a href="https://r4ds.had.co.nz" class="uri">https://r4ds.had.co.nz</a>.</p>
</div>
<div id="introduction-8" class="section level2" number="15.1">
<h2>
<span class="header-section-number">15.1</span> Introduction<a class="anchor" aria-label="anchor" href="#introduction-8"><i class="fas fa-link"></i></a>
</h2>
<p><code><a href="https://rdrr.io/r/base/match.html">%in%</a></code></p>
<p><code><a href="https://rdrr.io/r/base/c.html">c()</a></code></p>
<div class="sourceCode" id="cb259"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span>
<span class="co">#&gt; -- &lt;U+2029&gt;[1mAttaching packages&lt;U+2029&gt;[22m --------------------------------------- tidyverse 1.3.1 --</span>NA<span class="co">#&gt; &lt;U+2029&gt;[32mv&lt;U+2029&gt;[39m &lt;U+2029&gt;[34mggplot2&lt;U+2029&gt;[39m 3.3.5          &lt;U+2029&gt;[32mv&lt;U+2029&gt;[39m &lt;U+2029&gt;[34mpurrr  &lt;U+2029&gt;[39m 0.3.4     </span>NA<span class="co">#&gt; &lt;U+2029&gt;[32mv&lt;U+2029&gt;[39m &lt;U+2029&gt;[34mtibble &lt;U+2029&gt;[39m 3.1.2          &lt;U+2029&gt;[32mv&lt;U+2029&gt;[39m &lt;U+2029&gt;[34mdplyr  &lt;U+2029&gt;[39m 1.0.7     </span>NA<span class="co">#&gt; &lt;U+2029&gt;[32mv&lt;U+2029&gt;[39m &lt;U+2029&gt;[34mtidyr  &lt;U+2029&gt;[39m 1.1.3          &lt;U+2029&gt;[32mv&lt;U+2029&gt;[39m &lt;U+2029&gt;[34mstringr&lt;U+2029&gt;[39m 1.4.0.&lt;U+2029&gt;[31m9000&lt;U+2029&gt;[39m</span>NA<span class="co">#&gt; &lt;U+2029&gt;[32mv&lt;U+2029&gt;[39m &lt;U+2029&gt;[34mreadr  &lt;U+2029&gt;[39m 2.0.1          &lt;U+2029&gt;[32mv&lt;U+2029&gt;[39m &lt;U+2029&gt;[34mforcats&lt;U+2029&gt;[39m 0.5.1</span>NA<span class="co">#&gt; -- &lt;U+2029&gt;[1mConflicts&lt;U+2029&gt;[22m ------------------------------------------ tidyverse_conflicts() --</span>NA<span class="co">#&gt; &lt;U+2029&gt;[31mx&lt;U+2029&gt;[39m &lt;U+2029&gt;[34mdplyr&lt;U+2029&gt;[39m::&lt;U+2029&gt;[32mfilter()&lt;U+2029&gt;[39m masks &lt;U+2029&gt;[34mstats&lt;U+2029&gt;[39m::filter()</span>NA<span class="co">#&gt; &lt;U+2029&gt;[31mx&lt;U+2029&gt;[39m &lt;U+2029&gt;[34mdplyr&lt;U+2029&gt;[39m::&lt;U+2029&gt;[32mlag()&lt;U+2029&gt;[39m    masks &lt;U+2029&gt;[34mstats&lt;U+2029&gt;[39m::lag()</span>NA<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/hadley/nycflights13">nycflights13</a></span><span class="op">)</span>

<span class="va">not_cancelled</span> <span class="op">&lt;-</span> <span class="va">flights</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">dep_delay</span><span class="op">)</span>, <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">arr_delay</span><span class="op">)</span><span class="op">)</span></code></pre></div>
</div>
<div id="counts" class="section level2" number="15.2">
<h2>
<span class="header-section-number">15.2</span> Counts<a class="anchor" aria-label="anchor" href="#counts"><i class="fas fa-link"></i></a>
</h2>
<ul>
<li>
<p>Counts: You’ve seen <code>n()</code>, which takes no arguments, and returns the size of the current group.
To count the number of non-missing values, use <code><a href="https://rdrr.io/r/base/sum.html">sum(!is.na(x))</a></code>.
To count the number of distinct (unique) values, use <code>n_distinct(x)</code>.</p>
<div class="sourceCode" id="cb260"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Which destinations have the most carriers?</span>
<span class="va">not_cancelled</span> <span class="op">%&gt;%</span> 
  <span class="fu">group_by</span><span class="op">(</span><span class="va">dest</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">summarise</span><span class="op">(</span>carriers <span class="op">=</span> <span class="fu">n_distinct</span><span class="op">(</span><span class="va">carrier</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">arrange</span><span class="op">(</span><span class="fu">desc</span><span class="op">(</span><span class="va">carriers</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; &lt;U+2029&gt;[90m# A tibble: 104 x 2&lt;U+2029&gt;[39m</span>NA<span class="co">#&gt;   &lt;U+2029&gt;[1mdest&lt;U+2029&gt;[22m  &lt;U+2029&gt;[1mcarriers&lt;U+2029&gt;[22m</span>NA<span class="co">#&gt;   &lt;U+2029&gt;[3m&lt;U+2029&gt;[90m&lt;chr&gt;&lt;U+2029&gt;[39m&lt;U+2029&gt;[23m    &lt;U+2029&gt;[3m&lt;U+2029&gt;[90m&lt;int&gt;&lt;U+2029&gt;[39m&lt;U+2029&gt;[23m</span>NA<span class="co">#&gt; &lt;U+2029&gt;[90m1&lt;U+2029&gt;[39m ATL          7</span>NA<span class="co">#&gt; &lt;U+2029&gt;[90m2&lt;U+2029&gt;[39m BOS          7</span>NA<span class="co">#&gt; &lt;U+2029&gt;[90m3&lt;U+2029&gt;[39m CLT          7</span>NA<span class="co">#&gt; &lt;U+2029&gt;[90m4&lt;U+2029&gt;[39m ORD          7</span>NA<span class="co">#&gt; &lt;U+2029&gt;[90m5&lt;U+2029&gt;[39m TPA          7</span>NA<span class="co">#&gt; &lt;U+2029&gt;[90m6&lt;U+2029&gt;[39m AUS          6</span>NA<span class="co">#&gt; &lt;U+2029&gt;[90m# ... with 98 more rows&lt;U+2029&gt;[39m</span>NA</code></pre></div>
<p>Counts are so useful that dplyr provides a simple helper if all you want is a count:</p>
<div class="sourceCode" id="cb261"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">not_cancelled</span> <span class="op">%&gt;%</span> 
  <span class="fu">count</span><span class="op">(</span><span class="va">dest</span><span class="op">)</span>
<span class="co">#&gt; &lt;U+2029&gt;[90m# A tibble: 104 x 2&lt;U+2029&gt;[39m</span>NA<span class="co">#&gt;   &lt;U+2029&gt;[1mdest&lt;U+2029&gt;[22m      &lt;U+2029&gt;[1mn&lt;U+2029&gt;[22m</span>NA<span class="co">#&gt;   &lt;U+2029&gt;[3m&lt;U+2029&gt;[90m&lt;chr&gt;&lt;U+2029&gt;[39m&lt;U+2029&gt;[23m &lt;U+2029&gt;[3m&lt;U+2029&gt;[90m&lt;int&gt;&lt;U+2029&gt;[39m&lt;U+2029&gt;[23m</span>NA<span class="co">#&gt; &lt;U+2029&gt;[90m1&lt;U+2029&gt;[39m ABQ     254</span>NA<span class="co">#&gt; &lt;U+2029&gt;[90m2&lt;U+2029&gt;[39m ACK     264</span>NA<span class="co">#&gt; &lt;U+2029&gt;[90m3&lt;U+2029&gt;[39m ALB     418</span>NA<span class="co">#&gt; &lt;U+2029&gt;[90m4&lt;U+2029&gt;[39m ANC       8</span>NA<span class="co">#&gt; &lt;U+2029&gt;[90m5&lt;U+2029&gt;[39m ATL   &lt;U+2029&gt;[4m1&lt;U+2029&gt;[24m&lt;U+2029&gt;[4m6&lt;U+2029&gt;[24m837</span>NA<span class="co">#&gt; &lt;U+2029&gt;[90m6&lt;U+2029&gt;[39m AUS    &lt;U+2029&gt;[4m2&lt;U+2029&gt;[24m411</span>NA<span class="co">#&gt; &lt;U+2029&gt;[90m# ... with 98 more rows&lt;U+2029&gt;[39m</span>NA</code></pre></div>
<p>Just like with <code>group_by()</code>, you can also provide multiple variables to <code>count()</code>.</p>
<div class="sourceCode" id="cb262"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">not_cancelled</span> <span class="op">%&gt;%</span> 
  <span class="fu">count</span><span class="op">(</span><span class="va">carrier</span>, <span class="va">dest</span><span class="op">)</span>
<span class="co">#&gt; &lt;U+2029&gt;[90m# A tibble: 312 x 3&lt;U+2029&gt;[39m</span>NA<span class="co">#&gt;   &lt;U+2029&gt;[1mcarrier&lt;U+2029&gt;[22m &lt;U+2029&gt;[1mdest&lt;U+2029&gt;[22m      &lt;U+2029&gt;[1mn&lt;U+2029&gt;[22m</span>NA<span class="co">#&gt;   &lt;U+2029&gt;[3m&lt;U+2029&gt;[90m&lt;chr&gt;&lt;U+2029&gt;[39m&lt;U+2029&gt;[23m   &lt;U+2029&gt;[3m&lt;U+2029&gt;[90m&lt;chr&gt;&lt;U+2029&gt;[39m&lt;U+2029&gt;[23m &lt;U+2029&gt;[3m&lt;U+2029&gt;[90m&lt;int&gt;&lt;U+2029&gt;[39m&lt;U+2029&gt;[23m</span>NA<span class="co">#&gt; &lt;U+2029&gt;[90m1&lt;U+2029&gt;[39m 9E      ATL      56</span>NA<span class="co">#&gt; &lt;U+2029&gt;[90m2&lt;U+2029&gt;[39m 9E      AUS       2</span>NA<span class="co">#&gt; &lt;U+2029&gt;[90m3&lt;U+2029&gt;[39m 9E      AVL      10</span>NA<span class="co">#&gt; &lt;U+2029&gt;[90m4&lt;U+2029&gt;[39m 9E      BNA     452</span>NA<span class="co">#&gt; &lt;U+2029&gt;[90m5&lt;U+2029&gt;[39m 9E      BOS     853</span>NA<span class="co">#&gt; &lt;U+2029&gt;[90m6&lt;U+2029&gt;[39m 9E      BTV       2</span>NA<span class="co">#&gt; &lt;U+2029&gt;[90m# ... with 306 more rows&lt;U+2029&gt;[39m</span>NA</code></pre></div>
<p>You can optionally provide a weight variable.
For example, you could use this to “count” (sum) the total number of miles a plane flew:</p>
<div class="sourceCode" id="cb263"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">not_cancelled</span> <span class="op">%&gt;%</span> 
  <span class="fu">count</span><span class="op">(</span><span class="va">tailnum</span>, wt <span class="op">=</span> <span class="va">distance</span><span class="op">)</span>
<span class="co">#&gt; &lt;U+2029&gt;[90m# A tibble: 4,037 x 2&lt;U+2029&gt;[39m</span>NA<span class="co">#&gt;   &lt;U+2029&gt;[1mtailnum&lt;U+2029&gt;[22m      &lt;U+2029&gt;[1mn&lt;U+2029&gt;[22m</span>NA<span class="co">#&gt;   &lt;U+2029&gt;[3m&lt;U+2029&gt;[90m&lt;chr&gt;&lt;U+2029&gt;[39m&lt;U+2029&gt;[23m    &lt;U+2029&gt;[3m&lt;U+2029&gt;[90m&lt;dbl&gt;&lt;U+2029&gt;[39m&lt;U+2029&gt;[23m</span>NA<span class="co">#&gt; &lt;U+2029&gt;[90m1&lt;U+2029&gt;[39m D942DN    &lt;U+2029&gt;[4m3&lt;U+2029&gt;[24m418</span>NA<span class="co">#&gt; &lt;U+2029&gt;[90m2&lt;U+2029&gt;[39m N0EGMQ  &lt;U+2029&gt;[4m2&lt;U+2029&gt;[24m&lt;U+2029&gt;[4m3&lt;U+2029&gt;[24m&lt;U+2029&gt;[4m9&lt;U+2029&gt;[24m143</span>NA<span class="co">#&gt; &lt;U+2029&gt;[90m3&lt;U+2029&gt;[39m N10156  &lt;U+2029&gt;[4m1&lt;U+2029&gt;[24m&lt;U+2029&gt;[4m0&lt;U+2029&gt;[24m&lt;U+2029&gt;[4m9&lt;U+2029&gt;[24m664</span>NA<span class="co">#&gt; &lt;U+2029&gt;[90m4&lt;U+2029&gt;[39m N102UW   &lt;U+2029&gt;[4m2&lt;U+2029&gt;[24m&lt;U+2029&gt;[4m5&lt;U+2029&gt;[24m722</span>NA<span class="co">#&gt; &lt;U+2029&gt;[90m5&lt;U+2029&gt;[39m N103US   &lt;U+2029&gt;[4m2&lt;U+2029&gt;[24m&lt;U+2029&gt;[4m4&lt;U+2029&gt;[24m619</span>NA<span class="co">#&gt; &lt;U+2029&gt;[90m6&lt;U+2029&gt;[39m N104UW   &lt;U+2029&gt;[4m2&lt;U+2029&gt;[24m&lt;U+2029&gt;[4m4&lt;U+2029&gt;[24m616</span>NA<span class="co">#&gt; &lt;U+2029&gt;[90m# ... with 4,031 more rows&lt;U+2029&gt;[39m</span>NA</code></pre></div>
</li>
</ul>
</div>
<div id="window-functions" class="section level2" number="15.3">
<h2>
<span class="header-section-number">15.3</span> Window functions<a class="anchor" aria-label="anchor" href="#window-functions"><i class="fas fa-link"></i></a>
</h2>
<ul>
<li>
<p>Offsets: <code>lead()</code> and <code><a href="https://rdrr.io/r/stats/lag.html">lag()</a></code> allow you to refer to leading or lagging values.
This allows you to compute running differences (e.g. <code>x - lag(x)</code>) or find when values change (<code>x != lag(x)</code>).
They are most useful in conjunction with <code>group_by()</code>, which you’ll learn about shortly.</p>
<div class="sourceCode" id="cb264"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="op">(</span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">)</span>
<span class="co">#&gt;  [1]  1  2  3  4  5  6  7  8  9 10</span>
<span class="fu"><a href="https://rdrr.io/r/stats/lag.html">lag</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>
<span class="co">#&gt;  [1] NA  1  2  3  4  5  6  7  8  9</span>
<span class="fu">lead</span><span class="op">(</span><span class="va">x</span><span class="op">)</span>
<span class="co">#&gt;  [1]  2  3  4  5  6  7  8  9 10 NA</span></code></pre></div>
</li>
<li>
<p>Ranking: there are a number of ranking functions, but you should start with <code>min_rank()</code>.
It does the most usual type of ranking (e.g. 1st, 2nd, 2nd, 4th).
The default gives smallest values the small ranks; use <code>desc(x)</code> to give the largest values the smallest ranks.</p>
<div class="sourceCode" id="cb265"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">2</span>, <span class="cn">NA</span>, <span class="fl">3</span>, <span class="fl">4</span><span class="op">)</span>
<span class="fu">min_rank</span><span class="op">(</span><span class="va">y</span><span class="op">)</span>
<span class="co">#&gt; [1]  1  2  2 NA  4  5</span>
<span class="fu">min_rank</span><span class="op">(</span><span class="fu">desc</span><span class="op">(</span><span class="va">y</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; [1]  5  3  3 NA  2  1</span></code></pre></div>
<p>If <code>min_rank()</code> doesn’t do what you need, look at the variants <code>row_number()</code>, <code>dense_rank()</code>, <code>percent_rank()</code>, <code>cume_dist()</code>, <code>ntile()</code>.
See their help pages for more details.</p>
<div class="sourceCode" id="cb266"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">row_number</span><span class="op">(</span><span class="va">y</span><span class="op">)</span>
<span class="co">#&gt; [1]  1  2  3 NA  4  5</span>
<span class="fu">dense_rank</span><span class="op">(</span><span class="va">y</span><span class="op">)</span>
<span class="co">#&gt; [1]  1  2  2 NA  3  4</span>
<span class="fu">percent_rank</span><span class="op">(</span><span class="va">y</span><span class="op">)</span>
<span class="co">#&gt; [1] 0.00 0.25 0.25   NA 0.75 1.00</span>
<span class="fu">cume_dist</span><span class="op">(</span><span class="va">y</span><span class="op">)</span>
<span class="co">#&gt; [1] 0.2 0.6 0.6  NA 0.8 1.0</span></code></pre></div>
</li>
<li>
<p>Measures of position: <code>first(x)</code>, <code>nth(x, 2)</code>, <code>last(x)</code>.
These work similarly to <code>x[1]</code>, <code>x[2]</code>, and <code>x[length(x)]</code> but let you set a default value if that position does not exist (i.e. you’re trying to get the 3rd element from a group that only has two elements).
For example, we can find the first and last departure for each day:</p>
<div class="sourceCode" id="cb267"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">not_cancelled</span> <span class="op">%&gt;%</span> 
  <span class="fu">group_by</span><span class="op">(</span><span class="va">year</span>, <span class="va">month</span>, <span class="va">day</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">summarise</span><span class="op">(</span>
    first_dep <span class="op">=</span> <span class="fu">first</span><span class="op">(</span><span class="va">dep_time</span><span class="op">)</span>, 
    last_dep <span class="op">=</span> <span class="fu">last</span><span class="op">(</span><span class="va">dep_time</span><span class="op">)</span>
  <span class="op">)</span>
<span class="co">#&gt; `summarise()` has grouped output by 'year', 'month'. You can override using the `.groups` argument.</span>
<span class="co">#&gt; &lt;U+2029&gt;[90m# A tibble: 365 x 5&lt;U+2029&gt;[39m</span>NA<span class="co">#&gt; &lt;U+2029&gt;[90m# Groups:   year, month [12]&lt;U+2029&gt;[39m</span>NA<span class="co">#&gt;    &lt;U+2029&gt;[1myear&lt;U+2029&gt;[22m &lt;U+2029&gt;[1mmonth&lt;U+2029&gt;[22m   &lt;U+2029&gt;[1mday&lt;U+2029&gt;[22m &lt;U+2029&gt;[1mfirst_dep&lt;U+2029&gt;[22m &lt;U+2029&gt;[1mlast_dep&lt;U+2029&gt;[22m</span>NA<span class="co">#&gt;   &lt;U+2029&gt;[3m&lt;U+2029&gt;[90m&lt;int&gt;&lt;U+2029&gt;[39m&lt;U+2029&gt;[23m &lt;U+2029&gt;[3m&lt;U+2029&gt;[90m&lt;int&gt;&lt;U+2029&gt;[39m&lt;U+2029&gt;[23m &lt;U+2029&gt;[3m&lt;U+2029&gt;[90m&lt;int&gt;&lt;U+2029&gt;[39m&lt;U+2029&gt;[23m     &lt;U+2029&gt;[3m&lt;U+2029&gt;[90m&lt;int&gt;&lt;U+2029&gt;[39m&lt;U+2029&gt;[23m    &lt;U+2029&gt;[3m&lt;U+2029&gt;[90m&lt;int&gt;&lt;U+2029&gt;[39m&lt;U+2029&gt;[23m</span>NA<span class="co">#&gt; &lt;U+2029&gt;[90m1&lt;U+2029&gt;[39m  &lt;U+2029&gt;[4m2&lt;U+2029&gt;[24m013     1     1       517     &lt;U+2029&gt;[4m2&lt;U+2029&gt;[24m356</span>NA<span class="co">#&gt; &lt;U+2029&gt;[90m2&lt;U+2029&gt;[39m  &lt;U+2029&gt;[4m2&lt;U+2029&gt;[24m013     1     2        42     &lt;U+2029&gt;[4m2&lt;U+2029&gt;[24m354</span>NA<span class="co">#&gt; &lt;U+2029&gt;[90m3&lt;U+2029&gt;[39m  &lt;U+2029&gt;[4m2&lt;U+2029&gt;[24m013     1     3        32     &lt;U+2029&gt;[4m2&lt;U+2029&gt;[24m349</span>NA<span class="co">#&gt; &lt;U+2029&gt;[90m4&lt;U+2029&gt;[39m  &lt;U+2029&gt;[4m2&lt;U+2029&gt;[24m013     1     4        25     &lt;U+2029&gt;[4m2&lt;U+2029&gt;[24m358</span>NA<span class="co">#&gt; &lt;U+2029&gt;[90m5&lt;U+2029&gt;[39m  &lt;U+2029&gt;[4m2&lt;U+2029&gt;[24m013     1     5        14     &lt;U+2029&gt;[4m2&lt;U+2029&gt;[24m357</span>NA<span class="co">#&gt; &lt;U+2029&gt;[90m6&lt;U+2029&gt;[39m  &lt;U+2029&gt;[4m2&lt;U+2029&gt;[24m013     1     6        16     &lt;U+2029&gt;[4m2&lt;U+2029&gt;[24m355</span>NA<span class="co">#&gt; &lt;U+2029&gt;[90m# ... with 359 more rows&lt;U+2029&gt;[39m</span>NA</code></pre></div>
<p>These functions are complementary to filtering on ranks.
Filtering gives you all variables, with each observation in a separate row:</p>
<div class="sourceCode" id="cb268"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">not_cancelled</span> <span class="op">%&gt;%</span> 
  <span class="fu">group_by</span><span class="op">(</span><span class="va">year</span>, <span class="va">month</span>, <span class="va">day</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">mutate</span><span class="op">(</span>r <span class="op">=</span> <span class="fu">min_rank</span><span class="op">(</span><span class="fu">desc</span><span class="op">(</span><span class="va">dep_time</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">r</span> <span class="op">%in%</span> <span class="fu"><a href="https://rdrr.io/r/base/range.html">range</a></span><span class="op">(</span><span class="va">r</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; &lt;U+2029&gt;[90m# A tibble: 770 x 20&lt;U+2029&gt;[39m</span>NA<span class="co">#&gt; &lt;U+2029&gt;[90m# Groups:   year, month, day [365]&lt;U+2029&gt;[39m</span>NA<span class="co">#&gt;    &lt;U+2029&gt;[1myear&lt;U+2029&gt;[22m &lt;U+2029&gt;[1mmonth&lt;U+2029&gt;[22m   &lt;U+2029&gt;[1mday&lt;U+2029&gt;[22m &lt;U+2029&gt;[1mdep_time&lt;U+2029&gt;[22m &lt;U+2029&gt;[1msched_dep_time&lt;U+2029&gt;[22m &lt;U+2029&gt;[1mdep_delay&lt;U+2029&gt;[22m &lt;U+2029&gt;[1marr_time&lt;U+2029&gt;[22m &lt;U+2029&gt;[1msched_arr_time&lt;U+2029&gt;[22m</span>NA<span class="co">#&gt;   &lt;U+2029&gt;[3m&lt;U+2029&gt;[90m&lt;int&gt;&lt;U+2029&gt;[39m&lt;U+2029&gt;[23m &lt;U+2029&gt;[3m&lt;U+2029&gt;[90m&lt;int&gt;&lt;U+2029&gt;[39m&lt;U+2029&gt;[23m &lt;U+2029&gt;[3m&lt;U+2029&gt;[90m&lt;int&gt;&lt;U+2029&gt;[39m&lt;U+2029&gt;[23m    &lt;U+2029&gt;[3m&lt;U+2029&gt;[90m&lt;int&gt;&lt;U+2029&gt;[39m&lt;U+2029&gt;[23m          &lt;U+2029&gt;[3m&lt;U+2029&gt;[90m&lt;int&gt;&lt;U+2029&gt;[39m&lt;U+2029&gt;[23m     &lt;U+2029&gt;[3m&lt;U+2029&gt;[90m&lt;dbl&gt;&lt;U+2029&gt;[39m&lt;U+2029&gt;[23m    &lt;U+2029&gt;[3m&lt;U+2029&gt;[90m&lt;int&gt;&lt;U+2029&gt;[39m&lt;U+2029&gt;[23m          &lt;U+2029&gt;[3m&lt;U+2029&gt;[90m&lt;int&gt;&lt;U+2029&gt;[39m&lt;U+2029&gt;[23m</span>NA<span class="co">#&gt; &lt;U+2029&gt;[90m1&lt;U+2029&gt;[39m  &lt;U+2029&gt;[4m2&lt;U+2029&gt;[24m013     1     1      517            515         2      830            819</span>NA<span class="co">#&gt; &lt;U+2029&gt;[90m2&lt;U+2029&gt;[39m  &lt;U+2029&gt;[4m2&lt;U+2029&gt;[24m013     1     1     &lt;U+2029&gt;[4m2&lt;U+2029&gt;[24m356           &lt;U+2029&gt;[4m2&lt;U+2029&gt;[24m359        -&lt;U+2029&gt;[31m3&lt;U+2029&gt;[39m      425            437</span>NA<span class="co">#&gt; &lt;U+2029&gt;[90m3&lt;U+2029&gt;[39m  &lt;U+2029&gt;[4m2&lt;U+2029&gt;[24m013     1     2       42           &lt;U+2029&gt;[4m2&lt;U+2029&gt;[24m359        43      518            442</span>NA<span class="co">#&gt; &lt;U+2029&gt;[90m4&lt;U+2029&gt;[39m  &lt;U+2029&gt;[4m2&lt;U+2029&gt;[24m013     1     2     &lt;U+2029&gt;[4m2&lt;U+2029&gt;[24m354           &lt;U+2029&gt;[4m2&lt;U+2029&gt;[24m359        -&lt;U+2029&gt;[31m5&lt;U+2029&gt;[39m      413            437</span>NA<span class="co">#&gt; &lt;U+2029&gt;[90m5&lt;U+2029&gt;[39m  &lt;U+2029&gt;[4m2&lt;U+2029&gt;[24m013     1     3       32           &lt;U+2029&gt;[4m2&lt;U+2029&gt;[24m359        33      504            442</span>NA<span class="co">#&gt; &lt;U+2029&gt;[90m6&lt;U+2029&gt;[39m  &lt;U+2029&gt;[4m2&lt;U+2029&gt;[24m013     1     3     &lt;U+2029&gt;[4m2&lt;U+2029&gt;[24m349           &lt;U+2029&gt;[4m2&lt;U+2029&gt;[24m359       -&lt;U+2029&gt;[31m10&lt;U+2029&gt;[39m      434            445</span>NA<span class="co">#&gt; &lt;U+2029&gt;[90m# ... with 764 more rows, and 12 more variables: &lt;U+2029&gt;[1marr_delay&lt;U+2029&gt;[22m &lt;dbl&gt;,&lt;U+2029&gt;[39m</span>NA<span class="co">#&gt; &lt;U+2029&gt;[90m#   &lt;U+2029&gt;[1mcarrier&lt;U+2029&gt;[22m &lt;chr&gt;, &lt;U+2029&gt;[1mflight&lt;U+2029&gt;[22m &lt;int&gt;, &lt;U+2029&gt;[1mtailnum&lt;U+2029&gt;[22m &lt;chr&gt;, &lt;U+2029&gt;[1morigin&lt;U+2029&gt;[22m &lt;chr&gt;, &lt;U+2029&gt;[1mdest&lt;U+2029&gt;[22m &lt;chr&gt;,&lt;U+2029&gt;[39m</span>NA<span class="co">#&gt; &lt;U+2029&gt;[90m#   &lt;U+2029&gt;[1mair_time&lt;U+2029&gt;[22m &lt;dbl&gt;, &lt;U+2029&gt;[1mdistance&lt;U+2029&gt;[22m &lt;dbl&gt;, &lt;U+2029&gt;[1mhour&lt;U+2029&gt;[22m &lt;dbl&gt;, &lt;U+2029&gt;[1mminute&lt;U+2029&gt;[22m &lt;dbl&gt;, &lt;U+2029&gt;[1mtime_hour&lt;U+2029&gt;[22m &lt;dttm&gt;,&lt;U+2029&gt;[39m</span>NA<span class="co">#&gt; &lt;U+2029&gt;[90m#   &lt;U+2029&gt;[1mr&lt;U+2029&gt;[22m &lt;int&gt;&lt;U+2029&gt;[39m</span>NA</code></pre></div>
</li>
</ul>
<div id="dplyr" class="section level3" number="15.3.1">
<h3>
<span class="header-section-number">15.3.1</span> dplyr<a class="anchor" aria-label="anchor" href="#dplyr"><i class="fas fa-link"></i></a>
</h3>
<div class="sourceCode" id="cb269"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">flights_sml</span> <span class="op">&lt;-</span> <span class="fu">select</span><span class="op">(</span><span class="va">flights</span>, 
  <span class="va">year</span><span class="op">:</span><span class="va">day</span>, 
  <span class="fu">ends_with</span><span class="op">(</span><span class="st">"delay"</span><span class="op">)</span>, 
  <span class="va">distance</span>, 
  <span class="va">air_time</span>
<span class="op">)</span></code></pre></div>
<ul>
<li>
<p>Find the worst members of each group:</p>
<div class="sourceCode" id="cb270"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">flights_sml</span> <span class="op">%&gt;%</span> 
  <span class="fu">group_by</span><span class="op">(</span><span class="va">year</span>, <span class="va">month</span>, <span class="va">day</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rank.html">rank</a></span><span class="op">(</span><span class="fu">desc</span><span class="op">(</span><span class="va">arr_delay</span><span class="op">)</span><span class="op">)</span> <span class="op">&lt;</span> <span class="fl">10</span><span class="op">)</span>
<span class="co">#&gt; &lt;U+2029&gt;[90m# A tibble: 3,306 x 7&lt;U+2029&gt;[39m</span>NA<span class="co">#&gt; &lt;U+2029&gt;[90m# Groups:   year, month, day [365]&lt;U+2029&gt;[39m</span>NA<span class="co">#&gt;    &lt;U+2029&gt;[1myear&lt;U+2029&gt;[22m &lt;U+2029&gt;[1mmonth&lt;U+2029&gt;[22m   &lt;U+2029&gt;[1mday&lt;U+2029&gt;[22m &lt;U+2029&gt;[1mdep_delay&lt;U+2029&gt;[22m &lt;U+2029&gt;[1marr_delay&lt;U+2029&gt;[22m &lt;U+2029&gt;[1mdistance&lt;U+2029&gt;[22m &lt;U+2029&gt;[1mair_time&lt;U+2029&gt;[22m</span>NA<span class="co">#&gt;   &lt;U+2029&gt;[3m&lt;U+2029&gt;[90m&lt;int&gt;&lt;U+2029&gt;[39m&lt;U+2029&gt;[23m &lt;U+2029&gt;[3m&lt;U+2029&gt;[90m&lt;int&gt;&lt;U+2029&gt;[39m&lt;U+2029&gt;[23m &lt;U+2029&gt;[3m&lt;U+2029&gt;[90m&lt;int&gt;&lt;U+2029&gt;[39m&lt;U+2029&gt;[23m     &lt;U+2029&gt;[3m&lt;U+2029&gt;[90m&lt;dbl&gt;&lt;U+2029&gt;[39m&lt;U+2029&gt;[23m     &lt;U+2029&gt;[3m&lt;U+2029&gt;[90m&lt;dbl&gt;&lt;U+2029&gt;[39m&lt;U+2029&gt;[23m    &lt;U+2029&gt;[3m&lt;U+2029&gt;[90m&lt;dbl&gt;&lt;U+2029&gt;[39m&lt;U+2029&gt;[23m    &lt;U+2029&gt;[3m&lt;U+2029&gt;[90m&lt;dbl&gt;&lt;U+2029&gt;[39m&lt;U+2029&gt;[23m</span>NA<span class="co">#&gt; &lt;U+2029&gt;[90m1&lt;U+2029&gt;[39m  &lt;U+2029&gt;[4m2&lt;U+2029&gt;[24m013     1     1       853       851      184       41</span>NA<span class="co">#&gt; &lt;U+2029&gt;[90m2&lt;U+2029&gt;[39m  &lt;U+2029&gt;[4m2&lt;U+2029&gt;[24m013     1     1       290       338     &lt;U+2029&gt;[4m1&lt;U+2029&gt;[24m134      213</span>NA<span class="co">#&gt; &lt;U+2029&gt;[90m3&lt;U+2029&gt;[39m  &lt;U+2029&gt;[4m2&lt;U+2029&gt;[24m013     1     1       260       263      266       46</span>NA<span class="co">#&gt; &lt;U+2029&gt;[90m4&lt;U+2029&gt;[39m  &lt;U+2029&gt;[4m2&lt;U+2029&gt;[24m013     1     1       157       174      213       60</span>NA<span class="co">#&gt; &lt;U+2029&gt;[90m5&lt;U+2029&gt;[39m  &lt;U+2029&gt;[4m2&lt;U+2029&gt;[24m013     1     1       216       222      708      121</span>NA<span class="co">#&gt; &lt;U+2029&gt;[90m6&lt;U+2029&gt;[39m  &lt;U+2029&gt;[4m2&lt;U+2029&gt;[24m013     1     1       255       250      589      115</span>NA<span class="co">#&gt; &lt;U+2029&gt;[90m# ... with 3,300 more rows&lt;U+2029&gt;[39m</span>NA</code></pre></div>
</li>
<li>
<p>Find all groups bigger than a threshold:</p>
<div class="sourceCode" id="cb271"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">popular_dests</span> <span class="op">&lt;-</span> <span class="va">flights</span> <span class="op">%&gt;%</span> 
  <span class="fu">group_by</span><span class="op">(</span><span class="va">dest</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="fu">n</span><span class="op">(</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">365</span><span class="op">)</span>
<span class="va">popular_dests</span>
<span class="co">#&gt; &lt;U+2029&gt;[90m# A tibble: 332,577 x 19&lt;U+2029&gt;[39m</span>NA<span class="co">#&gt; &lt;U+2029&gt;[90m# Groups:   dest [77]&lt;U+2029&gt;[39m</span>NA<span class="co">#&gt;    &lt;U+2029&gt;[1myear&lt;U+2029&gt;[22m &lt;U+2029&gt;[1mmonth&lt;U+2029&gt;[22m   &lt;U+2029&gt;[1mday&lt;U+2029&gt;[22m &lt;U+2029&gt;[1mdep_time&lt;U+2029&gt;[22m &lt;U+2029&gt;[1msched_dep_time&lt;U+2029&gt;[22m &lt;U+2029&gt;[1mdep_delay&lt;U+2029&gt;[22m &lt;U+2029&gt;[1marr_time&lt;U+2029&gt;[22m &lt;U+2029&gt;[1msched_arr_time&lt;U+2029&gt;[22m</span>NA<span class="co">#&gt;   &lt;U+2029&gt;[3m&lt;U+2029&gt;[90m&lt;int&gt;&lt;U+2029&gt;[39m&lt;U+2029&gt;[23m &lt;U+2029&gt;[3m&lt;U+2029&gt;[90m&lt;int&gt;&lt;U+2029&gt;[39m&lt;U+2029&gt;[23m &lt;U+2029&gt;[3m&lt;U+2029&gt;[90m&lt;int&gt;&lt;U+2029&gt;[39m&lt;U+2029&gt;[23m    &lt;U+2029&gt;[3m&lt;U+2029&gt;[90m&lt;int&gt;&lt;U+2029&gt;[39m&lt;U+2029&gt;[23m          &lt;U+2029&gt;[3m&lt;U+2029&gt;[90m&lt;int&gt;&lt;U+2029&gt;[39m&lt;U+2029&gt;[23m     &lt;U+2029&gt;[3m&lt;U+2029&gt;[90m&lt;dbl&gt;&lt;U+2029&gt;[39m&lt;U+2029&gt;[23m    &lt;U+2029&gt;[3m&lt;U+2029&gt;[90m&lt;int&gt;&lt;U+2029&gt;[39m&lt;U+2029&gt;[23m          &lt;U+2029&gt;[3m&lt;U+2029&gt;[90m&lt;int&gt;&lt;U+2029&gt;[39m&lt;U+2029&gt;[23m</span>NA<span class="co">#&gt; &lt;U+2029&gt;[90m1&lt;U+2029&gt;[39m  &lt;U+2029&gt;[4m2&lt;U+2029&gt;[24m013     1     1      517            515         2      830            819</span>NA<span class="co">#&gt; &lt;U+2029&gt;[90m2&lt;U+2029&gt;[39m  &lt;U+2029&gt;[4m2&lt;U+2029&gt;[24m013     1     1      533            529         4      850            830</span>NA<span class="co">#&gt; &lt;U+2029&gt;[90m3&lt;U+2029&gt;[39m  &lt;U+2029&gt;[4m2&lt;U+2029&gt;[24m013     1     1      542            540         2      923            850</span>NA<span class="co">#&gt; &lt;U+2029&gt;[90m4&lt;U+2029&gt;[39m  &lt;U+2029&gt;[4m2&lt;U+2029&gt;[24m013     1     1      544            545        -&lt;U+2029&gt;[31m1&lt;U+2029&gt;[39m     &lt;U+2029&gt;[4m1&lt;U+2029&gt;[24m004           &lt;U+2029&gt;[4m1&lt;U+2029&gt;[24m022</span>NA<span class="co">#&gt; &lt;U+2029&gt;[90m5&lt;U+2029&gt;[39m  &lt;U+2029&gt;[4m2&lt;U+2029&gt;[24m013     1     1      554            600        -&lt;U+2029&gt;[31m6&lt;U+2029&gt;[39m      812            837</span>NA<span class="co">#&gt; &lt;U+2029&gt;[90m6&lt;U+2029&gt;[39m  &lt;U+2029&gt;[4m2&lt;U+2029&gt;[24m013     1     1      554            558        -&lt;U+2029&gt;[31m4&lt;U+2029&gt;[39m      740            728</span>NA<span class="co">#&gt; &lt;U+2029&gt;[90m# ... with 332,571 more rows, and 11 more variables: &lt;U+2029&gt;[1marr_delay&lt;U+2029&gt;[22m &lt;dbl&gt;,&lt;U+2029&gt;[39m</span>NA<span class="co">#&gt; &lt;U+2029&gt;[90m#   &lt;U+2029&gt;[1mcarrier&lt;U+2029&gt;[22m &lt;chr&gt;, &lt;U+2029&gt;[1mflight&lt;U+2029&gt;[22m &lt;int&gt;, &lt;U+2029&gt;[1mtailnum&lt;U+2029&gt;[22m &lt;chr&gt;, &lt;U+2029&gt;[1morigin&lt;U+2029&gt;[22m &lt;chr&gt;, &lt;U+2029&gt;[1mdest&lt;U+2029&gt;[22m &lt;chr&gt;,&lt;U+2029&gt;[39m</span>NA<span class="co">#&gt; &lt;U+2029&gt;[90m#   &lt;U+2029&gt;[1mair_time&lt;U+2029&gt;[22m &lt;dbl&gt;, &lt;U+2029&gt;[1mdistance&lt;U+2029&gt;[22m &lt;dbl&gt;, &lt;U+2029&gt;[1mhour&lt;U+2029&gt;[22m &lt;dbl&gt;, &lt;U+2029&gt;[1mminute&lt;U+2029&gt;[22m &lt;dbl&gt;, &lt;U+2029&gt;[1mtime_hour&lt;U+2029&gt;[22m &lt;dttm&gt;&lt;U+2029&gt;[39m</span>NA</code></pre></div>
</li>
<li>
<p>Standardise to compute per group metrics:</p>
<div class="sourceCode" id="cb272"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">popular_dests</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">arr_delay</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">mutate</span><span class="op">(</span>prop_delay <span class="op">=</span> <span class="va">arr_delay</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">arr_delay</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">select</span><span class="op">(</span><span class="va">year</span><span class="op">:</span><span class="va">day</span>, <span class="va">dest</span>, <span class="va">arr_delay</span>, <span class="va">prop_delay</span><span class="op">)</span>
<span class="co">#&gt; &lt;U+2029&gt;[90m# A tibble: 131,106 x 6&lt;U+2029&gt;[39m</span>NA<span class="co">#&gt; &lt;U+2029&gt;[90m# Groups:   dest [77]&lt;U+2029&gt;[39m</span>NA<span class="co">#&gt;    &lt;U+2029&gt;[1myear&lt;U+2029&gt;[22m &lt;U+2029&gt;[1mmonth&lt;U+2029&gt;[22m   &lt;U+2029&gt;[1mday&lt;U+2029&gt;[22m &lt;U+2029&gt;[1mdest&lt;U+2029&gt;[22m  &lt;U+2029&gt;[1marr_delay&lt;U+2029&gt;[22m &lt;U+2029&gt;[1mprop_delay&lt;U+2029&gt;[22m</span>NA<span class="co">#&gt;   &lt;U+2029&gt;[3m&lt;U+2029&gt;[90m&lt;int&gt;&lt;U+2029&gt;[39m&lt;U+2029&gt;[23m &lt;U+2029&gt;[3m&lt;U+2029&gt;[90m&lt;int&gt;&lt;U+2029&gt;[39m&lt;U+2029&gt;[23m &lt;U+2029&gt;[3m&lt;U+2029&gt;[90m&lt;int&gt;&lt;U+2029&gt;[39m&lt;U+2029&gt;[23m &lt;U+2029&gt;[3m&lt;U+2029&gt;[90m&lt;chr&gt;&lt;U+2029&gt;[39m&lt;U+2029&gt;[23m     &lt;U+2029&gt;[3m&lt;U+2029&gt;[90m&lt;dbl&gt;&lt;U+2029&gt;[39m&lt;U+2029&gt;[23m      &lt;U+2029&gt;[3m&lt;U+2029&gt;[90m&lt;dbl&gt;&lt;U+2029&gt;[39m&lt;U+2029&gt;[23m</span>NA<span class="co">#&gt; &lt;U+2029&gt;[90m1&lt;U+2029&gt;[39m  &lt;U+2029&gt;[4m2&lt;U+2029&gt;[24m013     1     1 IAH          11  0.000&lt;U+2029&gt;[4m1&lt;U+2029&gt;[24m&lt;U+2029&gt;[4m1&lt;U+2029&gt;[24m&lt;U+2029&gt;[4m1&lt;U+2029&gt;[24m </span>NA<span class="co">#&gt; &lt;U+2029&gt;[90m2&lt;U+2029&gt;[39m  &lt;U+2029&gt;[4m2&lt;U+2029&gt;[24m013     1     1 IAH          20  0.000&lt;U+2029&gt;[4m2&lt;U+2029&gt;[24m&lt;U+2029&gt;[4m0&lt;U+2029&gt;[24m&lt;U+2029&gt;[4m1&lt;U+2029&gt;[24m </span>NA<span class="co">#&gt; &lt;U+2029&gt;[90m3&lt;U+2029&gt;[39m  &lt;U+2029&gt;[4m2&lt;U+2029&gt;[24m013     1     1 MIA          33  0.000&lt;U+2029&gt;[4m2&lt;U+2029&gt;[24m&lt;U+2029&gt;[4m3&lt;U+2029&gt;[24m&lt;U+2029&gt;[4m5&lt;U+2029&gt;[24m </span>NA<span class="co">#&gt; &lt;U+2029&gt;[90m4&lt;U+2029&gt;[39m  &lt;U+2029&gt;[4m2&lt;U+2029&gt;[24m013     1     1 ORD          12  0.000&lt;U+2029&gt;[4m0&lt;U+2029&gt;[24m&lt;U+2029&gt;[4m4&lt;U+2029&gt;[24m&lt;U+2029&gt;[4m2&lt;U+2029&gt;[24m4</span>NA<span class="co">#&gt; &lt;U+2029&gt;[90m5&lt;U+2029&gt;[39m  &lt;U+2029&gt;[4m2&lt;U+2029&gt;[24m013     1     1 FLL          19  0.000&lt;U+2029&gt;[4m0&lt;U+2029&gt;[24m&lt;U+2029&gt;[4m9&lt;U+2029&gt;[24m&lt;U+2029&gt;[4m3&lt;U+2029&gt;[24m8</span>NA<span class="co">#&gt; &lt;U+2029&gt;[90m6&lt;U+2029&gt;[39m  &lt;U+2029&gt;[4m2&lt;U+2029&gt;[24m013     1     1 ORD           8  0.000&lt;U+2029&gt;[4m0&lt;U+2029&gt;[24m&lt;U+2029&gt;[4m2&lt;U+2029&gt;[24m&lt;U+2029&gt;[4m8&lt;U+2029&gt;[24m3</span>NA<span class="co">#&gt; &lt;U+2029&gt;[90m# ... with 131,100 more rows&lt;U+2029&gt;[39m</span>NA</code></pre></div>
</li>
</ul>
<p>A grouped filter is a grouped mutate followed by an ungrouped filter.
I generally avoid them except for quick and dirty manipulations: otherwise it’s hard to check that you’ve done the manipulation correctly.</p>
<p>Functions that work most naturally in grouped mutates and filters are known as window functions (vs. the summary functions used for summaries).
You can learn more about useful window functions in the corresponding vignette: <code>vignette("window-functions")</code>.</p>
</div>
<div id="exercises-27" class="section level3" number="15.3.2">
<h3>
<span class="header-section-number">15.3.2</span> Exercises<a class="anchor" aria-label="anchor" href="#exercises-27"><i class="fas fa-link"></i></a>
</h3>
<ol style="list-style-type: decimal">
<li><p>Find the 10 most delayed flights using a ranking function.
How do you want to handle ties?
Carefully read the documentation for <code>min_rank()</code>.</p></li>
<li><p>Which plane (<code>tailnum</code>) has the worst on-time record?</p></li>
<li><p>What time of day should you fly if you want to avoid delays as much as possible?</p></li>
<li><p>For each destination, compute the total minutes of delay.
For each flight, compute the proportion of the total delay for its destination.</p></li>
<li><p>Delays are typically temporally correlated: even once the problem that caused the initial delay has been resolved, later flights are delayed to allow earlier flights to leave.
Using <code><a href="https://rdrr.io/r/stats/lag.html">lag()</a></code>, explore how the delay of a flight is related to the delay of the immediately preceding flight.</p></li>
<li><p>Look at each destination.
Can you find flights that are suspiciously fast?
(i.e. flights that represent a potential data entry error).
Compute the air time of a flight relative to the shortest flight to that destination.
Which flights were most delayed in the air?</p></li>
<li><p>Find all destinations that are flown by at least two carriers.
Use that information to rank the carriers.</p></li>
<li>
</ol>
</div>
</div>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="relational-data.html"><span class="header-section-number">14</span> Relational data</a></div>
<div class="next"><a href="logicals-numbers.html"><span class="header-section-number">16</span> Logicals and numbers</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#vector-tools"><span class="header-section-number">15</span> Vector tools</a></li>
<li><a class="nav-link" href="#introduction-8"><span class="header-section-number">15.1</span> Introduction</a></li>
<li><a class="nav-link" href="#counts"><span class="header-section-number">15.2</span> Counts</a></li>
<li>
<a class="nav-link" href="#window-functions"><span class="header-section-number">15.3</span> Window functions</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#dplyr"><span class="header-section-number">15.3.1</span> dplyr</a></li>
<li><a class="nav-link" href="#exercises-27"><span class="header-section-number">15.3.2</span> Exercises</a></li>
</ul>
</li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
<li><a id="book-source" href="https://github.com/hadley/r4ds/blob/master/vector-tools.Rmd">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="https://github.com/hadley/r4ds/edit/master/vector-tools.Rmd">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>R for Data Science (2e)</strong>" was written by Hadley Wickham and Garrett Grolemund. </p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script><script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>
</html>
